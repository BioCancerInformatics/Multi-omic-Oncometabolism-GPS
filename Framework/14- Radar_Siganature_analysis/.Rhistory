# Verificar se há dados de expressão retornados
if (!is.null(Results_expression[["data"]])) {
# Extrair dados de expressão
tpm_data <- Results_expression[["data"]][["value"]]
type2_data <- Results_expression[["data"]][["type2"]]
# Verificar se há dados suficientes para calcular as medianas
if (sum(type2_data == "tumor", na.rm = TRUE) > 0 && sum(type2_data == "normal", na.rm = TRUE) > 0) {
# Calcular as medianas dos grupos tumor e normal
tumor_median <- median(tpm_data[type2_data == "tumor"], na.rm = TRUE)
normal_median <- median(tpm_data[type2_data == "normal"], na.rm = TRUE)
# Determinar se é Overexpression ou Underexpression
if (tumor_median > normal_median) {
network_table$Expression[i] <- "Overexpression"
} else {
network_table$Expression[i] <- "Underexpression"
}
}
}
# Verificar se há p-values retornados
if (length(Results_expression$layers[[3]]$data) > 0) {
# Extrair os p-values
p_values <- Results_expression$layers[[3]]$data
# Adicionar os p-values às colunas correspondentes
network_table$Expression_p.sgnif[i] <- p_values$p.signif
network_table$Expression_p.adj[i] <- p_values$p.adj
# Classificar como "Unchanged" se o valor de p for maior ou igual a 0.05
if (p_values$p.adj >= 0.05) {
network_table$Expression[i] <- "Unchanged"
}
}
}, error = function(e) {
# Captura e imprime o erro, mas continua a execução do loop
print(paste("Erro ao analisar câncer:", cancer_type))
print(e)
})
}
# Verificar se a coluna "Expression_p.adj" existe na tabela
if("Expression_p.adj" %in% colnames(network_table)) {
# Adicionar uma nova coluna para armazenar os valores transformados pelo log10
network_table$log10_p.adj <- -log10(network_table$Expression_p.adj)
# Imprimir uma mensagem de conclusão
print("coluna 'log10(p.adj)' adicionada com sucesso!")
}
# Remover linhas duplicadas, se houver
network_table <- unique(network_table)
# FINAL DA PARTE ADICIONADA #
# Lista dos valores de corte de correlação
correlation_cutoffs <- c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0)
# Initialize an empty vector to store status messages
status_messages <- c()
# Loop through the correlation cutoffs
for (cutoff in correlation_cutoffs) {
init_message <- paste("Processing for correlation cutoff:", cutoff)
# Append the initial message to status_messages
status_messages <- c(status_messages, init_message)
# Print the initial message to the console
cat(init_message, "\n")
cat("Processing for correlation cutoff:", cutoff, "\n")
# Atualize a variável de corte de correlação no código
correlation_cutoff = cutoff
# Filtre com base no valor de corte de correlação
network_table_filtered <- subset(network_table, correlation >= correlation_cutoff | correlation <= -correlation_cutoff)
# Verifique se há pelo menos um resultado antes de salvar
if (nrow(network_table_filtered) > 0) {
tryCatch({
##### Set up nodes ----
nodes = get_gene_cancer_node_table(network_table_filtered)
###### Get cancer types for each gene
cancers_by_genes = aggregate(cancer_types ~ genes,
data = network_table_filtered,
FUN = function(x) paste(unique(x),
collapse = "/"))
nodes = left_join(nodes, cancers_by_genes, by=join_by(nodes == genes))
# Function to check signature sign directions
sign_verification <- function(network_table) {
has_positive <- any(network_table$correlation > 0)
has_negative <- any(network_table$correlation < 0)
if (has_positive & has_negative) {
return(c('positive', 'negative'))
} else if (has_positive) {
return('positive')
} else if (has_negative) {
return('negative')
} else {
return(character(0))  # Return an empty vector if there are no correlations.
}
}
# Salve os resultados com o nome de arquivo apropriado
network_filename <- paste0('results/gene_cancer_correlation_network_', cutoff, '.tsv')
nodes_filename <- paste0('results/gene_cancer_nodes_network_', cutoff, '.tsv')
write.table(network_table_filtered,
network_filename,
sep = '\t',
quote = FALSE,
row.names = FALSE)
write.table(nodes,
nodes_filename,
sep = '\t',
quote = FALSE,
row.names = FALSE)
completion_message <- paste("Processing for correlation cutoff:", cutoff, "completed.")
cat(completion_message, "\n")
# Append the completion message to status_messages
status_messages <- c(status_messages, completion_message)
}, error = function(e) {
no_result_message <- paste("No results for correlation cutoff:", cutoff)
# Append the no result message to status_messages
status_messages <- c(status_messages, no_result_message)
})
} else {
no_result_message <- paste("No results for correlation cutoff:", cutoff)
cat(no_result_message, "\n")
# Append the no result message to status_messages
status_messages <- c(status_messages, no_result_message)
}
}
# Save the status messages
write.table(status_messages,
"results/cutoff_status.tsv",
sep = "\t",
quote = FALSE,
col.names = FALSE,
row.names = FALSE)
# Define the path to the 'results' subdirectory
results_directory <- file.path(getwd(), "results")
# Locate the files with the highest numerical suffix in the 'results' directory
files <- list.files(path = results_directory,
pattern = "gene_cancer_correlation_network_\\d+\\.\\d+\\.tsv",
full.names = TRUE)
# Process to find the highest numerical suffix
if (length(files) > 0) {
suffixes <- gsub(".*gene_cancer_correlation_network_", "", files)
suffixes <- gsub("\\.tsv", "", suffixes)
numeric_suffixes <- as.numeric(suffixes)
if (length(numeric_suffixes) > 0) {
highest_suffix <- max(numeric_suffixes, na.rm = TRUE)
highest_serial_file <- files[which(numeric_suffixes == highest_suffix)]
# Read the file with the highest serial number
highest_data <- read.delim(highest_serial_file, stringsAsFactors = FALSE)
highest_suffix_found <- highest_suffix
}
}
# Optional: Write the highest suffix found to a text file and print it
highest_suffix_found_path <- file.path(results_directory, "highest_suffix_found.txt")
write.table(highest_suffix_found,  # assuming 'highest_suffix_found' is your data
highest_suffix_found_path,
col.names = FALSE,
row.names = FALSE,
quote = FALSE)
# Optional: Print the highest suffix found
cat("The highest suffix found is: ", highest_suffix_found, "\n")
end_time <- now()
cat("Processing ended at:", format(end_time, "%Y-%m-%d %H:%M:%S"), "\n")
processing_time <- interval(start_time, end_time)
cat("Processing time:", as.duration(processing_time), "\n")
peak_memory <- round(max(memory.size()) / 1024, 2)
cat("Highest peak of RAM memory used:", peak_memory, "MB", "\n")
output_file <- "processing_stats.txt"
file_conn <- file(output_file, "a")
writeLines(paste("Start Time:", format(start_time, "%Y-%m-%d %H:%M:%S")), file_conn)
writeLines(paste("End Time:", format(end_time, "%Y-%m-%d %H:%M:%S")), file_conn)
writeLines(paste("Processing Time:", as.duration(processing_time)), file_conn)
writeLines(paste("Peak RAM Memory Used:", peak_memory, "MB"), file_conn)
# Close the file connection
close(file_conn)
# Save the current main_workspace to a file named 'main_workspace.RData' in the current working directory
save.image(file = "main_workspace.RData")
# Alternatively, if you want to confirm the file path where the main_workspace is saved, you can use:
current_working_directory <- getwd()  # Get the current working directory
main_workspace_path <- file.path(current_working_directory, "main_workspace.RData")  # Build the file path
save.image(file = main_workspace_path)  # Save the main_workspace
cat("main_workspace saved to: ", main_workspace_path, "\n")  # Print confirmation message with file path
# Save the session information to a file
main_session_info_path <- file.path(current_working_directory, "main_session_info.txt")
sink(main_session_info_path)  # Redirect output to file
sessionInfo()  # Print session information
sink()  # Stop redirecting output
cat("Session information saved to: ", main_session_info_path, "\n")
setwd("E:/Higor/Cancer_metabolism_project/14- Radar_Siganature_analysis/")
# Função para importar e adicionar colunas de identificação
import_and_label <- function(filepath, genotypic_var, phenotypic_var) {
import(filepath) %>%
mutate(Genotypic_var = genotypic_var, Phenotypic_var = phenotypic_var)
}
# Lista de arquivos e suas respectivas colunas de identificação
file_info <- list(
list("MSI_PanCan/CNV_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Microsatellite instability"),
list("MSI_PanCan/Methylation_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Microsatellite instability"),
list("MSI_PanCan/mRNA_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Microsatellite instability"),
list("MSI_PanCan/Mutation_vs_MSI/results/gene_cancer_msi_correlation_network_0.1.tsv", "Mutation", "Microsatellite instability"),
list("MSI_PanCan/Protein_vs_MSI/results/gene_cancer_msi_correlation_network_0.1.tsv", "Protein expression", "Microsatellite instability"),
list("MSI_PanCan/miRNA_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Microsatellite instability"),
list("Stemness_PanCan/CNV_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Stemness"),
list("Stemness_PanCan/Methylation_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Stemness"),
list("Stemness_PanCan/mRNA_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Stemness"),
list("Stemness_PanCan/Mutation_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Mutation", "Stemness"),
list("Stemness_PanCan/Protein_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Protein expression", "Stemness"),
list("Stemness_PanCan/miRNA_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Stemness"),
list("TMB_PanCan/CNV_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Tumor mutational burden"),
list("TMB_PanCan/Methylation_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Tumor mutational burden"),
list("TMB_PanCan/mRNA_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Tumor mutational burden"),
list("TMB_PanCan/Mutation_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Mutation", "Tumor mutational burden"),
list("TMB_PanCan/Protein_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Protein expression", "Tumor mutational burden"),
list("TMB_PanCan/miRNA_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Tumor mutational burden")
)
# Importar e combinar todos os dados
All_results <- file_info %>%
lapply(function(info) {
filepath <- info[[1]]
genotypic_var <- info[[2]]
phenotypic_var <- info[[3]]
import_and_label(filepath, genotypic_var, phenotypic_var)
}) %>%
bind_rows()
genes <- import("/Higor/Cancer_metabolism_project/13- Building_metabolic_signatures/Gene_lncRNA_miRNA_Protein_signatures.rds")
# Função para processar assinaturas corretamente
process_gene_name <- function(gene) {
# Remover crases se presentes
gene <- gsub("`", "", gene)
# Verificar se há múltiplos membros na assinatura
if (grepl("\\+", gene)) {
# Remover parênteses existentes antes de processar
gene <- gsub("^\\(|\\)$", "", gene)
# Dividir os elementos da assinatura
members <- unlist(strsplit(gene, " \\+ "))
# Adicionar crase nos membros que contêm "-"
members <- sapply(members, function(x) {
if (grepl("-", x)) {
return(paste0("`", x, "`"))  # Adiciona crases
} else {
return(x)
}
})
# Reconstruir a assinatura formatada com os membros processados
formatted_gene <- paste(members, collapse = " + ")
# Manter um único par de parênteses
return(paste0("(", formatted_gene, ")"))
} else {
# Se for uma assinatura única, remover parênteses
return(gsub("\\(|\\)", "", gene))
}
}
# Substituir os valores na coluna Multiomics_Signature usando a função process_gene_name()
genes$Multiomics_Signature_Original <- genes$Multiomics_Signature  # Armazena original para comparação
genes$Multiomics_Signature <- sapply(genes$Multiomics_Signature, process_gene_name)
# Remove duplicates based on the specified columns
Signatures <- genes %>%
distinct(Multiomics_Signature, Cancer_types, Omic_layer, Phenotypic_layer, .keep_all = TRUE)
# Rename columns in Signatures to match All_results for join
Signatures_renamed <- Signatures %>%
rename(
genes = Multiomics_Signature,
cancer_types = Cancer_types,
Genotypic_var = Omic_layer,
Phenotypic_var = Phenotypic_layer
)
# Perform the semi-join to keep only matching rows
Filtered_results <- All_results %>%
semi_join(Signatures_renamed, by = c("genes", "cancer_types", "Genotypic_var", "Phenotypic_var"))
# Seleciona apenas as 3 colunas de interesse em cada df
df1_sel <- Filtered_results %>%
dplyr::select(genes, Genotypic_var, Phenotypic_var) %>%
dplyr::distinct()
df2_sel <- Signatures_renamed %>%
dplyr::select(genes, Genotypic_var, Phenotypic_var) %>%
dplyr::distinct()
# Combinações presentes só em df1
only_in_df1 <- dplyr::anti_join(df1_sel, df2_sel,
by = c("genes", "Genotypic_var", "Phenotypic_var")) %>%
dplyr::mutate(Source = "Filtered_results")
# Combinações presentes só em df2
only_in_df2 <- dplyr::anti_join(df2_sel, df1_sel,
by = c("genes", "Genotypic_var", "Phenotypic_var")) %>%
dplyr::mutate(Source = "Signatures_renamed")
# Junta os dois conjuntos em uma tabela final
diff_combinations <- dplyr::bind_rows(only_in_df1, only_in_df2)
View(only_in_df2)
View(Signatures_renamed)
df <- vis_gene_stemness_cor(
Gene = "(NDUFA11 + NDUFA7)",
cor_method = "spearman",
data_type = "cnv",
Plot = "TRUE",
opt_pancan = .opt_pancan
)
View(df)
View(df[["data"]])
setwd("C:/Users/NUDIM/Desktop")
## Se quiser salvar
rio::export(diff_combinations, "diff_combinations.tsv")
View(only_in_df2)
setwd("E:/Higor/Cancer_metabolism_project/14- Radar_Siganature_analysis/")
# Função para importar e adicionar colunas de identificação
import_and_label <- function(filepath, genotypic_var, phenotypic_var) {
import(filepath) %>%
mutate(Genotypic_var = genotypic_var, Phenotypic_var = phenotypic_var)
}
# Lista de arquivos e suas respectivas colunas de identificação
file_info <- list(
list("MSI_PanCan/CNV_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Microsatellite instability"),
list("MSI_PanCan/Methylation_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Microsatellite instability"),
list("MSI_PanCan/mRNA_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Microsatellite instability"),
list("MSI_PanCan/Mutation_vs_MSI/results/gene_cancer_msi_correlation_network_0.1.tsv", "Mutation", "Microsatellite instability"),
list("MSI_PanCan/Protein_vs_MSI/results/gene_cancer_msi_correlation_network_0.1.tsv", "Protein expression", "Microsatellite instability"),
list("MSI_PanCan/miRNA_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Microsatellite instability"),
list("Stemness_PanCan/CNV_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Stemness"),
list("Stemness_PanCan/Methylation_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Stemness"),
list("Stemness_PanCan/mRNA_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Stemness"),
list("Stemness_PanCan/Mutation_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Mutation", "Stemness"),
list("Stemness_PanCan/Protein_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Protein expression", "Stemness"),
list("Stemness_PanCan/miRNA_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Stemness"),
list("TMB_PanCan/CNV_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Tumor mutational burden"),
list("TMB_PanCan/Methylation_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Tumor mutational burden"),
list("TMB_PanCan/mRNA_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Tumor mutational burden"),
list("TMB_PanCan/Mutation_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Mutation", "Tumor mutational burden"),
list("TMB_PanCan/Protein_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Protein expression", "Tumor mutational burden"),
list("TMB_PanCan/miRNA_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Tumor mutational burden")
)
# Lista de arquivos e suas respectivas colunas de identificação
file_info <- list(
list("MSI_PanCan/CNV_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Microsatellite instability"),
list("MSI_PanCan/Methylation_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Microsatellite instability"),
list("MSI_PanCan/mRNA_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Microsatellite instability"),
list("MSI_PanCan/Mutation_vs_MSI/results/gene_cancer_msi_correlation_network_0.1.tsv", "Mutation", "Microsatellite instability"),
list("MSI_PanCan/Protein_vs_MSI/results/gene_cancer_msi_correlation_network_0.1.tsv", "Protein expression", "Microsatellite instability"),
list("MSI_PanCan/miRNA_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Microsatellite instability"),
list("Stemness_PanCan/CNV_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Stemness"),
list("Stemness_PanCan/Methylation_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Stemness"),
list("Stemness_PanCan/mRNA_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Stemness"),
list("Stemness_PanCan/Mutation_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Mutation", "Stemness"),
list("Stemness_PanCan/Protein_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Protein expression", "Stemness"),
list("Stemness_PanCan/miRNA_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Stemness"),
list("TMB_PanCan/CNV_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Tumor mutational burden"),
list("TMB_PanCan/Methylation_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Tumor mutational burden"),
list("TMB_PanCan/mRNA_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Tumor mutational burden"),
list("TMB_PanCan/Mutation_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Mutation", "Tumor mutational burden"),
list("TMB_PanCan/Protein_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Protein expression", "Tumor mutational burden"),
list("TMB_PanCan/miRNA_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Tumor mutational burden")
)
# Importar e combinar todos os dados
All_results <- file_info %>%
lapply(function(info) {
filepath <- info[[1]]
genotypic_var <- info[[2]]
phenotypic_var <- info[[3]]
import_and_label(filepath, genotypic_var, phenotypic_var)
}) %>%
bind_rows()
genes <- import("/Higor/Cancer_metabolism_project/13- Building_metabolic_signatures/Gene_lncRNA_miRNA_Protein_signatures.tsv")
View(All_results)
# Função para processar assinaturas corretamente
process_gene_name <- function(gene) {
# Remover crases se presentes
gene <- gsub("`", "", gene)
# Verificar se há múltiplos membros na assinatura
if (grepl("\\+", gene)) {
# Remover parênteses existentes antes de processar
gene <- gsub("^\\(|\\)$", "", gene)
# Dividir os elementos da assinatura
members <- unlist(strsplit(gene, " \\+ "))
# Adicionar crase nos membros que contêm "-"
members <- sapply(members, function(x) {
if (grepl("-", x)) {
return(paste0("`", x, "`"))  # Adiciona crases
} else {
return(x)
}
})
# Reconstruir a assinatura formatada com os membros processados
formatted_gene <- paste(members, collapse = " + ")
# Manter um único par de parênteses
return(paste0("(", formatted_gene, ")"))
} else {
# Se for uma assinatura única, remover parênteses
return(gsub("\\(|\\)", "", gene))
}
}
# Substituir os valores na coluna Multiomics_Signature usando a função process_gene_name()
genes$Multiomics_Signature_Original <- genes$Multiomics_Signature  # Armazena original para comparação
genes$Multiomics_Signature <- sapply(genes$Multiomics_Signature, process_gene_name)
# Remove duplicates based on the specified columns
Signatures <- genes %>%
distinct(Multiomics_Signature, Cancer_types, Omic_layer, Phenotypic_layer, .keep_all = TRUE)
# Rename columns in Signatures to match All_results for join
Signatures_renamed <- Signatures %>%
rename(
genes = Multiomics_Signature,
cancer_types = Cancer_types,
Genotypic_var = Omic_layer,
Phenotypic_var = Phenotypic_layer
)
# Perform the semi-join to keep only matching rows
Filtered_results <- All_results %>%
semi_join(Signatures_renamed, by = c("genes", "cancer_types", "Genotypic_var", "Phenotypic_var"))
# Seleciona apenas as 3 colunas de interesse em cada df
df1_sel <- Filtered_results %>%
dplyr::select(genes, Genotypic_var, Phenotypic_var) %>%
dplyr::distinct()
df2_sel <- Signatures_renamed %>%
dplyr::select(genes, Genotypic_var, Phenotypic_var) %>%
dplyr::distinct()
# Combinações presentes só em df1
only_in_df1 <- dplyr::anti_join(df1_sel, df2_sel,
by = c("genes", "Genotypic_var", "Phenotypic_var")) %>%
dplyr::mutate(Source = "Filtered_results")
# Combinações presentes só em df2
only_in_df2 <- dplyr::anti_join(df2_sel, df1_sel,
by = c("genes", "Genotypic_var", "Phenotypic_var")) %>%
dplyr::mutate(Source = "Signatures_renamed")
# Junta os dois conjuntos em uma tabela final
diff_combinations <- dplyr::bind_rows(only_in_df1, only_in_df2)
View(diff_combinations)
View(Signatures_renamed)
setwd("E:/Higor/Cancer_metabolism_project/14- Radar_Siganature_analysis/")
# Função para importar e adicionar colunas de identificação
import_and_label <- function(filepath, genotypic_var, phenotypic_var) {
import(filepath) %>%
mutate(Genotypic_var = genotypic_var, Phenotypic_var = phenotypic_var)
}
# Lista de arquivos e suas respectivas colunas de identificação
file_info <- list(
list("MSI_PanCan/CNV_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Microsatellite instability"),
list("MSI_PanCan/Methylation_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Microsatellite instability"),
list("MSI_PanCan/mRNA_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Microsatellite instability"),
list("MSI_PanCan/Mutation_vs_MSI/results/gene_cancer_msi_correlation_network_0.1.tsv", "Mutation", "Microsatellite instability"),
list("MSI_PanCan/Protein_vs_MSI/results/gene_cancer_msi_correlation_network_0.1.tsv", "Protein expression", "Microsatellite instability"),
list("MSI_PanCan/miRNA_vs_MSI/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Microsatellite instability"),
list("Stemness_PanCan/CNV_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Stemness"),
list("Stemness_PanCan/Methylation_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Stemness"),
list("Stemness_PanCan/mRNA_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Stemness"),
list("Stemness_PanCan/Mutation_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Mutation", "Stemness"),
list("Stemness_PanCan/Protein_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "Protein expression", "Stemness"),
list("Stemness_PanCan/miRNA_vs_Stemness/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Stemness"),
list("TMB_PanCan/CNV_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "CNV", "Tumor mutational burden"),
list("TMB_PanCan/Methylation_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Methylation", "Tumor mutational burden"),
list("TMB_PanCan/mRNA_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Gene expression", "Tumor mutational burden"),
list("TMB_PanCan/Mutation_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Mutation", "Tumor mutational burden"),
list("TMB_PanCan/Protein_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "Protein expression", "Tumor mutational burden"),
list("TMB_PanCan/miRNA_vs_TMB/results/gene_cancer_correlation_network_0.1.tsv", "miRNA expression", "Tumor mutational burden")
)
# Importar e combinar todos os dados
All_results <- file_info %>%
lapply(function(info) {
filepath <- info[[1]]
genotypic_var <- info[[2]]
phenotypic_var <- info[[3]]
import_and_label(filepath, genotypic_var, phenotypic_var)
}) %>%
bind_rows()
genes <- import("/Higor/Cancer_metabolism_project/13- Building_metabolic_signatures/Gene_lncRNA_miRNA_Protein_signatures.tsv")
# Função para processar assinaturas corretamente
process_gene_name <- function(gene) {
# Remover crases se presentes
gene <- gsub("`", "", gene)
# Verificar se há múltiplos membros na assinatura
if (grepl("\\+", gene)) {
# Remover parênteses existentes antes de processar
gene <- gsub("^\\(|\\)$", "", gene)
# Dividir os elementos da assinatura
members <- unlist(strsplit(gene, " \\+ "))
# Adicionar crase nos membros que contêm "-"
members <- sapply(members, function(x) {
if (grepl("-", x)) {
return(paste0("`", x, "`"))  # Adiciona crases
} else {
return(x)
}
})
# Reconstruir a assinatura formatada com os membros processados
formatted_gene <- paste(members, collapse = " + ")
# Manter um único par de parênteses
return(paste0("(", formatted_gene, ")"))
} else {
# Se for uma assinatura única, remover parênteses
return(gsub("\\(|\\)", "", gene))
}
}
# Substituir os valores na coluna Multiomics_Signature usando a função process_gene_name()
genes$Multiomics_Signature_Original <- genes$Multiomics_Signature  # Armazena original para comparação
genes$Multiomics_Signature <- sapply(genes$Multiomics_Signature, process_gene_name)
# Remove duplicates based on the specified columns
Signatures <- genes %>%
distinct(Multiomics_Signature, Cancer_types, Omic_layer, Phenotypic_layer, .keep_all = TRUE)
# Rename columns in Signatures to match All_results for join
Signatures_renamed <- Signatures %>%
rename(
genes = Multiomics_Signature,
cancer_types = Cancer_types,
Genotypic_var = Omic_layer,
Phenotypic_var = Phenotypic_layer
)
# Perform the semi-join to keep only matching rows
Filtered_results <- All_results %>%
semi_join(Signatures_renamed, by = c("genes", "cancer_types", "Genotypic_var", "Phenotypic_var"))
# Seleciona apenas as 3 colunas de interesse em cada df
df1_sel <- Filtered_results %>%
dplyr::select(genes, Genotypic_var, Phenotypic_var) %>%
dplyr::distinct()
df2_sel <- Signatures_renamed %>%
dplyr::select(genes, Genotypic_var, Phenotypic_var) %>%
dplyr::distinct()
# Combinações presentes só em df1
only_in_df1 <- dplyr::anti_join(df1_sel, df2_sel,
by = c("genes", "Genotypic_var", "Phenotypic_var")) %>%
dplyr::mutate(Source = "Filtered_results")
# Combinações presentes só em df2
only_in_df2 <- dplyr::anti_join(df2_sel, df1_sel,
by = c("genes", "Genotypic_var", "Phenotypic_var")) %>%
dplyr::mutate(Source = "Signatures_renamed")
# Junta os dois conjuntos em uma tabela final
diff_combinations <- dplyr::bind_rows(only_in_df1, only_in_df2)
View(diff_combinations)
